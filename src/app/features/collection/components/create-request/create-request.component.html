<div class="container mx-auto p-6">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Create Collection Request</mat-card-title>
      <mat-card-subtitle>Fill in the details for your recycling collection request</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="requestForm" (ngSubmit)="onSubmit()" class="space-y-6">
        <!-- Waste Types -->
        <mat-form-field class="w-full">
          <mat-label>Waste Types</mat-label>
          <mat-select formControlName="wasteTypes" multiple>
            <mat-option *ngFor="let type of wasteTypes" [value]="type">
              {{type | titlecase}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="requestForm.get('wasteTypes')?.hasError('required')">
            Please select at least one waste type
          </mat-error>
        </mat-form-field>

        <!-- Weight -->
        <mat-form-field class="w-full">
          <mat-label>Weight (kg)</mat-label>
          <input matInput type="number" formControlName="weight" min="1" max="10" step="0.1">
          <mat-hint>Minimum: 1kg, Maximum: 10kg</mat-hint>
          <mat-error *ngIf="requestForm.get('weight')?.hasError('required')">
            Weight is required
          </mat-error>
          <mat-error *ngIf="requestForm.get('weight')?.hasError('min')">
            Weight must be at least 1kg
          </mat-error>
          <mat-error *ngIf="requestForm.get('weight')?.hasError('max')">
            Weight cannot exceed 10kg
          </mat-error>
        </mat-form-field>

        <!-- Address -->
        <mat-form-field class="w-full">
          <mat-label>Collection Address</mat-label>
          <textarea matInput formControlName="address" rows="3"></textarea>
          <mat-error *ngIf="requestForm.get('address')?.hasError('required')">
            Address is required
          </mat-error>
        </mat-form-field>

        <!-- City -->
        <mat-form-field class="w-full">
          <mat-label>City</mat-label>
          <input matInput formControlName="city">
          <mat-error *ngIf="requestForm.get('city')?.hasError('required')">
            City is required
          </mat-error>
        </mat-form-field>

        <!-- Date -->
        <mat-form-field class="w-full">
          <mat-label>Collection Date</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="date">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error *ngIf="requestForm.get('date')?.hasError('required')">
            Date is required
          </mat-error>
          <mat-error *ngIf="requestForm.get('date')?.hasError('pastDate')">
            Please select a future date
          </mat-error>
        </mat-form-field>

        <!-- Time Slot -->
        <mat-form-field class="w-full">
          <mat-label>Time Slot</mat-label>
          <mat-select formControlName="timeSlot">
            <mat-option *ngFor="let slot of timeSlots" [value]="slot">
              {{slot}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="requestForm.get('timeSlot')?.hasError('required')">
            Time slot is required
          </mat-error>
        </mat-form-field>

        <!-- Photos Upload -->
        <div class="photo-upload" (click)="fileInput.click()">
          <input
            #fileInput
            type="file"
            accept="image/*"
            multiple
            (change)="onFileSelected($event)"
            class="hidden"
          >
          <mat-icon class="text-4xl text-gray-400">cloud_upload</mat-icon>
          <p class="mt-2">Click to upload photos (optional)</p>
          <p class="text-sm text-gray-500">Maximum 5 photos</p>
        </div>

        <!-- Selected Photos Preview -->
        <div *ngIf="selectedPhotos.length > 0" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mt-4">
          <div *ngFor="let photo of selectedPhotos; let i = index" class="relative">
            <img [src]="photo | safeUrl" alt="Selected photo" class="w-full h-32 object-cover rounded">
            <button
              mat-icon-button
              color="warn"
              class="absolute top-0 right-0 bg-white"
              (click)="removePhoto(i)"
            >
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>

        <!-- Notes -->
        <mat-form-field class="w-full">
          <mat-label>Additional Notes</mat-label>
          <textarea matInput formControlName="notes" rows="3"></textarea>
        </mat-form-field>
      </form>
    </mat-card-content>

    <mat-card-actions align="end">
      <button
        mat-button
        routerLink="/collection/my-requests"
      >
        Cancel
      </button>
      <button
        mat-raised-button
        color="primary"
        (click)="onSubmit()"
        [disabled]="!requestForm.valid || pendingRequestsCount >= 3"
      >
        Create Request
      </button>
    </mat-card-actions>
  </mat-card>
</div> 